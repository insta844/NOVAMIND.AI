<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>NovaMind AI - ChatGPT Clone</title>
    <!-- Tailwind + Font Awesome + Marked -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* EXACT CHATGPT COLORS & SHADING */
        :root {
            --chatgpt-bg: #ffffff;
            --chatgpt-sidebar: #f7f7f8;
            --chatgpt-border: #e5e5e5;
            --chatgpt-user-bubble: #f4f4f4;
            --chatgpt-ai-bubble: #ffffff;
            --chatgpt-text: #1a1a1a;
            --chatgpt-input-bg: #ffffff;
            --chatgpt-chip-bg: #f0f0f0;
            --chatgpt-shadow: 0 2px 6px rgba(0, 0, 0, 0.02), 0 1px 2px rgba(0, 0, 0, 0.05);
            --chatgpt-hover: #e5e5e5;
            --accent-color: #19c37d;
        }

        .dark {
            --chatgpt-bg: #343541;
            --chatgpt-sidebar: #202123;
            --chatgpt-border: #4a4b5e;
            --chatgpt-user-bubble: #2b2b2b;
            --chatgpt-ai-bubble: #444654;
            --chatgpt-text: #ececf1;
            --chatgpt-input-bg: #40414f;
            --chatgpt-chip-bg: #2d2d2d;
            --chatgpt-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            --chatgpt-hover: #40414f;
        }

        body {
            font-family: 'S√∂hne', -apple-system, system-ui, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background-color: var(--chatgpt-bg);
            color: var(--chatgpt-text);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background: #4a4b5e; }

        /* Sidebar */
        .sidebar {
            background-color: var(--chatgpt-sidebar);
            border-right: 1px solid var(--chatgpt-border);
        }

        /* Main area */
        .main-area {
            background-color: var(--chatgpt-bg);
        }

        /* Message bubbles */
        .message-row {
            display: flex;
            margin: 1.5rem 0;
            padding: 0 1rem;
        }
        .message-row.user { justify-content: flex-end; }
        .message-row.assistant { justify-content: flex-start; }

        .bubble {
            max-width: 70%;
            padding: 0.9rem 1.2rem;
            line-height: 1.6;
            font-size: 0.95rem;
            word-wrap: break-word;
            position: relative;
        }
        .bubble.user {
            background-color: var(--chatgpt-user-bubble);
            color: var(--chatgpt-text);
            border-radius: 1.5rem 1.5rem 0.25rem 1.5rem;
            box-shadow: var(--chatgpt-shadow);
        }
        .bubble.assistant {
            background-color: var(--chatgpt-ai-bubble);
            color: var(--chatgpt-text);
            border-radius: 1.5rem 1.5rem 1.5rem 0.25rem;
            box-shadow: var(--chatgpt-shadow);
            border: 1px solid rgba(0,0,0,0.03);
        }

        /* Welcome screen */
        .welcome-title {
            color: var(--chatgpt-text);
            font-size: 2.2rem;
            font-weight: 500;
            letter-spacing: -0.02em;
            margin-bottom: 2rem;
        }

        /* Suggestion chips */
        .chip {
            background-color: var(--chatgpt-chip-bg);
            color: var(--chatgpt-text);
            padding: 0.75rem 1.5rem;
            border-radius: 2.5rem;
            font-size: 0.95rem;
            font-weight: 400;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
        }
        .chip:hover {
            background-color: var(--chatgpt-hover);
        }
        .chip.active {
            border-color: var(--accent-color);
            background-color: rgba(25, 195, 125, 0.1);
            transform: scale(1.02);
        }
        .chip i {
            color: #8e8ea0;
            font-size: 1rem;
        }
        .chip.active i {
            color: var(--accent-color);
        }

        /* Cancel mode button */
        .cancel-mode-btn {
            background-color: #ff4d4d;
            color: white;
            padding: 0.3rem 1rem;
            border-radius: 2rem;
            font-size: 0.8rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin-left: 0.5rem;
            transition: 0.2s;
            border: none;
        }
        .cancel-mode-btn:hover {
            background-color: #ff3333;
            transform: scale(1.02);
        }

        /* Input area */
        .input-area {
            background-color: var(--chatgpt-bg);
            border-top: 1px solid var(--chatgpt-border);
            padding: 1.5rem 2rem;
            position: sticky;
            bottom: 0;
        }
        .input-wrapper {
            background-color: var(--chatgpt-input-bg);
            border: 1px solid var(--chatgpt-border);
            border-radius: 2rem;
            padding: 0.3rem 0.3rem 0.3rem 1.5rem;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.02);
        }
        .dark .input-wrapper {
            background-color: #40414f;
            border-color: #4a4b5e;
        }
        textarea {
            background: transparent;
            border: none;
            outline: none;
            resize: none;
            padding: 0.8rem 0;
            color: var(--chatgpt-text);
            font-size: 0.95rem;
            width: 100%;
        }
        textarea::placeholder {
            color: #8e8ea0;
        }
        .action-buttons {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .action-btn {
            background: transparent;
            border: none;
            color: #8e8ea0;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }
        .action-btn:hover {
            background-color: var(--chatgpt-hover);
            color: var(--accent-color);
        }
        .send-btn {
            background-color: var(--accent-color);
            color: white;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            border: none;
            opacity: 0.8;
        }
        .send-btn:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        /* Mode indicator */
        .mode-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .mode-badge {
            background-color: var(--accent-color);
            color: white;
            padding: 0.2rem 1rem;
            border-radius: 2rem;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Typing indicator */
        .typing-indicator {
            display: flex;
            gap: 0.4rem;
            padding: 0.8rem 1.2rem;
            background-color: var(--chatgpt-ai-bubble);
            border-radius: 1.5rem 1.5rem 1.5rem 0.25rem;
            width: fit-content;
            border: 1px solid var(--chatgpt-border);
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #8e8ea0;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }

        /* Code blocks */
        .code-block {
            background: #0d1117;
            border-radius: 12px;
            margin: 0.75rem 0;
            overflow: hidden;
        }
        .code-header {
            background: #161b22;
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #8b949e;
            font-size: 0.75rem;
            border-bottom: 1px solid #30363d;
        }
        .code-content {
            padding: 1rem;
            overflow-x: auto;
            color: #e6edf3;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
        }
        .copy-btn {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            border-radius: 4px;
            padding: 2px 8px;
            cursor: pointer;
            font-size: 0.7rem;
        }
        .copy-btn:hover { background: #30363d; }

        /* Settings modal */
        .modal-overlay {
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
        }
        .settings-option {
            padding: 1rem;
            border: 1px solid var(--chatgpt-border);
            border-radius: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .settings-option:hover {
            background-color: var(--chatgpt-hover);
        }
        .settings-option-title {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }
        .settings-option-desc {
            font-size: 0.85rem;
            color: #8e8ea0;
        }

        /* Image preview */
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 1rem;
            margin-top: 0.5rem;
            border: 2px solid var(--accent-color);
        }

        /* Logo */
        .novamind-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .novamind-symbol {
            font-size: 80px;
            font-weight: 800;
            letter-spacing: -8px;
            background: linear-gradient(135deg, #00c6ff, #8e2de2, #ff00cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
            line-height: 1;
            margin-bottom: 5px;
        }

        .novamind-symbol::after {
            content: "";
            position: absolute;
            right: -30px;
            top: 10px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8e2de2, #ff00cc, #ff0080);
            border-radius: 50%;
            clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 50% 80%, 0% 100%);
            opacity: 0.9;
            filter: blur(1px);
        }

        .novamind-text {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 3px;
            background: linear-gradient(90deg, #00c6ff, #8e2de2, #ff00cc, #ff0080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-top: 5px;
            text-transform: uppercase;
        }

        /* Sidebar logo */
        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sidebar-symbol {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -3px;
            background: linear-gradient(135deg, #00c6ff, #8e2de2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }
        .sidebar-symbol::after {
            content: "";
            position: absolute;
            right: -12px;
            top: 4px;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #8e2de2, #ff00cc);
            border-radius: 50%;
            clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 50% 80%, 0% 100%);
            opacity: 0.85;
        }
        .sidebar-text {
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 1px;
            background: linear-gradient(90deg, #00c6ff, #8e2de2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body>
    <!-- ================================================= -->
    <!-- üî• API KEY AUR MODEL - AB WORKING HAI -->
    <!-- ================================================= -->
    <script>
        // üî• Aapki API key - same hai
        const OWNER_API_KEY = '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';
        
        // ‚úÖ WORKING FREE MODEL - DeepSeek R1 (sabse powerful)
        const DEFAULT_MODEL = 'deepseek/deepseek-r1:free';
    </script>

    <div id="app" class="h-screen flex overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar w-72 hidden md:flex flex-col flex-shrink-0">
            <div class="p-4 border-b border-[#e5e5e5] dark:border-[#4a4b5e]">
                <div class="sidebar-logo">
                    <div class="sidebar-symbol">N</div>
                    <div class="sidebar-text">NOVAMIND</div>
                </div>
            </div>
            <button id="newChatDesktop" class="mx-3 my-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md py-2 flex items-center justify-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-700">
                <i class="fas fa-plus"></i> New chat
            </button>
            <div id="chatListDesktop" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
            <div class="p-3 border-t border-[#e5e5e5] dark:border-[#4a4b5e]">
                <button id="settingsDesktop" class="w-full text-left px-3 py-2 rounded-md hover:bg-[#e5e5e5] dark:hover:bg-[#40414f] flex items-center gap-3">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button id="darkModeDesktop" class="w-full text-left px-3 py-2 rounded-md hover:bg-[#e5e5e5] dark:hover:bg-[#40414f] flex items-center gap-3 mt-1">
                    <i class="fas fa-moon"></i> Dark mode
                </button>
            </div>
        </aside>

        <!-- Mobile sidebar -->
        <aside id="mobileSidebar" class="fixed inset-y-0 left-0 w-72 sidebar z-30 md:hidden flex flex-col transform -translate-x-full transition-transform duration-200">
            <div class="p-4 border-b border-[#e5e5e5] dark:border-[#4a4b5e] flex justify-between items-center">
                <div class="sidebar-logo">
                    <div class="sidebar-symbol">N</div>
                    <div class="sidebar-text">NOVAMIND</div>
                </div>
                <button id="closeMobileSidebar" class="p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <button id="newChatMobile" class="mx-3 my-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md py-2 flex items-center justify-center gap-2">+ New chat</button>
            <div id="chatListMobile" class="flex-1 overflow-y-auto p-2"></div>
            <div class="p-3 border-t border-[#e5e5e5] dark:border-[#4a4b5e]">
                <button id="settingsMobile" class="w-full text-left px-3 py-2 rounded-md hover:bg-[#e5e5e5] dark:hover:bg-[#40414f] flex items-center gap-3">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button id="darkModeMobile" class="w-full text-left px-3 py-2 rounded-md hover:bg-[#e5e5e5] dark:hover:bg-[#40414f] flex items-center gap-3 mt-1">
                    <i class="fas fa-moon"></i> Dark mode
                </button>
            </div>
        </aside>

        <!-- Main chat area -->
        <main class="flex-1 flex flex-col main-area">
            <!-- Mobile header -->
            <div class="md:hidden flex items-center p-3 border-b border-[#e5e5e5] dark:border-[#4a4b5e]">
                <button id="openMobileSidebar" class="p-2 -ml-2">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <span class="ml-3 font-medium">NovaMind</span>
            </div>

            <!-- Messages container -->
            <div id="messageContainer" class="flex-1 overflow-y-auto">
                <!-- Welcome screen -->
                <div id="welcomeScreen" class="h-full flex flex-col items-center justify-center px-4 text-center">
                    <div class="novamind-logo mb-8">
                        <div class="novamind-symbol">N</div>
                        <div class="novamind-text">NOVAMIND.AI</div>
                    </div>
                    
                    <h1 class="welcome-title">What can I help with?</h1>
                    <div class="flex flex-wrap gap-3 justify-center max-w-2xl">
                        <div class="chip" id="chipImage" onclick="selectMode('image')">
                            <i class="fas fa-image"></i> Create image
                        </div>
                        <div class="chip" id="chipCode" onclick="selectMode('code')">
                            <i class="fas fa-code"></i> Code
                        </div>
                        <div class="chip" id="chipAnalyze" onclick="selectMode('analyze')">
                            <i class="fas fa-chart-bar"></i> Analyze data
                        </div>
                        <div class="chip" id="chipBrainstorm" onclick="selectMode('brainstorm')">
                            <i class="fas fa-lightbulb"></i> Brainstorm
                        </div>
                    </div>
                </div>
                <!-- Message feed -->
                <div id="messageFeed" class="hidden py-4"></div>
                <!-- Typing indicator -->
                <div id="typingIndicator" class="hidden px-4">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <!-- Input area -->
            <div class="input-area">
                <div class="mode-indicator" id="modeIndicator" style="display: none;">
                    <span class="mode-badge" id="activeModeBadge"></span>
                    <button class="cancel-mode-btn" onclick="cancelMode()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
                <div class="input-wrapper">
                    <textarea id="messageInput" rows="1" placeholder="Message NovaMind..." class="flex-1"></textarea>
                    <div class="action-buttons">
                        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                        <button class="action-btn" onclick="document.getElementById('imageUpload').click();">
                            <i class="fas fa-image"></i>
                        </button>
                        <button class="send-btn" id="sendBtn">
                            <i class="fas fa-paper-plane text-sm"></i>
                        </button>
                    </div>
                </div>
                <div id="imagePreviewContainer" style="display: none;" class="mt-2">
                    <img id="imagePreview" class="image-preview">
                    <button class="text-sm text-red-500 mt-1" onclick="clearImage()">Remove</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings modal -->
    <div id="settingsModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-[#40414f] rounded-xl max-w-md w-full p-6 max-h-[80vh] overflow-y-auto">
            <h2 class="text-xl font-semibold mb-4 flex justify-between items-center">
                Settings
                <button onclick="closeSettings()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </h2>
            
            <!-- Language Option -->
            <div class="settings-option" onclick="openLanguageSettings()">
                <div class="settings-option-title">
                    <i class="fas fa-language mr-2"></i> Language
                </div>
                <div class="settings-option-desc" id="selectedLanguageDisplay">English</div>
            </div>

            <!-- About AI Option -->
            <div class="settings-option" onclick="showAboutAI()">
                <div class="settings-option-title">
                    <i class="fas fa-info-circle mr-2"></i> About AI
                </div>
                <div class="settings-option-desc">Learn about NovaMind AI</div>
            </div>

            <!-- Data Control Option -->
            <div class="settings-option" onclick="showDataControl()">
                <div class="settings-option-title">
                    <i class="fas fa-database mr-2"></i> Data Control
                </div>
                <div class="settings-option-desc">Manage your data and privacy</div>
            </div>

            <!-- Clear History Option -->
            <div class="settings-option" onclick="confirmClearHistory()">
                <div class="settings-option-title text-red-500">
                    <i class="fas fa-trash mr-2"></i> Clear History
                </div>
                <div class="settings-option-desc">Delete all chat conversations</div>
            </div>

            <!-- Theme Color Option -->
            <div class="settings-option" onclick="openThemeSettings()">
                <div class="settings-option-title">
                    <i class="fas fa-palette mr-2"></i> Theme Color
                </div>
                <div class="settings-option-desc" id="selectedThemeDisplay">Default Green</div>
            </div>

            <!-- System Prompt -->
            <div class="mt-4">
                <label class="block text-sm font-medium mb-1">System Prompt</label>
                <textarea id="systemPromptInput" rows="3" class="w-full border dark:border-gray-600 rounded-md p-2 dark:bg-[#4a4b5e]">You are a helpful assistant.</textarea>
            </div>

            <!-- Temperature -->
            <div class="mt-4">
                <label class="block text-sm font-medium mb-1">Temperature: <span id="tempDisplay">0.7</span></label>
                <input type="range" id="temperatureRange" min="0" max="2" step="0.1" value="0.7" class="w-full">
            </div>

            <div class="flex gap-2 mt-6">
                <button onclick="closeSettings()" class="flex-1 border py-2 rounded-md">Close</button>
                <button onclick="saveSettings()" class="flex-1 text-white py-2 rounded-md" style="background-color: var(--accent-color);">Save</button>
            </div>
        </div>
    </div>

    <!-- Language Selection Modal -->
    <div id="languageModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-[#40414f] rounded-xl max-w-md w-full p-6">
            <h2 class="text-xl font-semibold mb-4">Select Language</h2>
            <div class="space-y-2">
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700" onclick="selectLanguage('english')">üá¨üáß English</div>
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700" onclick="selectLanguage('hindi')">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</div>
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700" onclick="selectLanguage('hinglish')">üáÆüá≥ Hinglish</div>
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700" onclick="selectLanguage('urdu')">üáµüá∞ ÿßÿ±ÿØŸà</div>
            </div>
            <button onclick="closeLanguageModal()" class="w-full mt-4 border py-2 rounded-lg">Cancel</button>
        </div>
    </div>

    <!-- About AI Modal -->
    <div id="aboutModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-[#40414f] rounded-xl max-w-md w-full p-6">
            <h2 class="text-xl font-semibold mb-4">About NovaMind AI</h2>
            <div class="space-y-3">
                <p>‚ú® Version 1.0.0</p>
                <p>ü§ñ Powered by OpenRouter AI</p>
                <p>üé® Multiple AI models: DeepSeek, GPT-4o, Gemini, DALL-E, Mistral</p>
                <p>üì± ChatGPT-style interface</p>
                <p>üîí Your data is stored locally</p>
                <p>üåê Created with ‚ù§Ô∏è for you</p>
            </div>
            <button onclick="closeAboutModal()" class="w-full mt-4 text-white py-2 rounded-lg" style="background-color: var(--accent-color);">Close</button>
        </div>
    </div>

    <!-- Data Control Modal -->
    <div id="dataControlModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-[#40414f] rounded-xl max-w-md w-full p-6">
            <h2 class="text-xl font-semibold mb-4">Data Control</h2>
            <div class="space-y-4">
                <p>All your chat data is stored locally in your browser. No data is sent to any server except when communicating with AI APIs.</p>
                <div class="flex items-center justify-between p-3 border rounded-lg">
                    <span>Local Storage Usage</span>
                    <span id="storageSize">Calculating...</span>
                </div>
                <button onclick="exportData()" class="w-full border py-2 rounded-lg">üì• Export Chat Data</button>
            </div>
            <button onclick="closeDataControlModal()" class="w-full mt-4 text-white py-2 rounded-lg" style="background-color: var(--accent-color);">Close</button>
        </div>
    </div>

    <!-- Theme Color Modal -->
    <div id="themeModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-[#40414f] rounded-xl max-w-md w-full p-6">
            <h2 class="text-xl font-semibold mb-4">Select Theme Color</h2>
            <div class="grid grid-cols-2 gap-3">
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100" style="border-left: 5px solid #19c37d;" onclick="selectTheme('green')">Green (Default)</div>
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100" style="border-left: 5px solid #3b82f6;" onclick="selectTheme('blue')">Blue</div>
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100" style="border-left: 5px solid #a855f7;" onclick="selectTheme('purple')">Purple</div>
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100" style="border-left: 5px solid #ec4899;" onclick="selectTheme('pink')">Pink</div>
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100" style="border-left: 5px solid #ef4444;" onclick="selectTheme('red')">Red</div>
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100" style="border-left: 5px solid #f59e0b;" onclick="selectTheme('orange')">Orange</div>
                <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100 col-span-2" style="border-left: 5px solid #000000;" onclick="selectTheme('black')">‚ö´ Black</div>
            </div>
            <button onclick="closeThemeModal()" class="w-full mt-4 border py-2 rounded-lg">Cancel</button>
        </div>
    </div>

    <script>
        (function() {
            // API Key - same
            const API_KEY = OWNER_API_KEY;
            // Model - ab DeepSeek R1 free hai

            // State
            let state = {
                chats: JSON.parse(localStorage.getItem('nova_chats') || '[]'),
                activeChatId: localStorage.getItem('nova_active') || null,
                darkMode: localStorage.getItem('nova_dark') === 'true',
                systemPrompt: localStorage.getItem('nova_system') || 'You are a helpful assistant.',
                temperature: parseFloat(localStorage.getItem('nova_temp') || '0.7'),
                language: localStorage.getItem('nova_lang') || 'english',
                themeColor: localStorage.getItem('nova_theme') || 'green'
            };

            let abortController = null;
            let currentMode = 'chat';
            let selectedImage = null;

            function init() {
                if (state.chats.length === 0) createNewChat();
                applyTheme();
                applyThemeColor();
                renderChatLists();
                loadActiveChat();
                updateLanguageDisplay();

                document.getElementById('systemPromptInput').value = state.systemPrompt;
                document.getElementById('temperatureRange').value = state.temperature;
                document.getElementById('tempDisplay').innerText = state.temperature;

                setupEventListeners();
            }

            function createNewChat() {
                const chatName = prompt('Enter chat name:', 'New chat');
                if (!chatName) return;
                
                const chat = {
                    id: Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                    title: chatName,
                    messages: [],
                    createdAt: new Date().toISOString()
                };
                state.chats.unshift(chat);
                state.activeChatId = chat.id;
                saveState();
                renderChatLists();
                loadActiveChat();
            }

            function saveState() {
                localStorage.setItem('nova_chats', JSON.stringify(state.chats));
                localStorage.setItem('nova_active', state.activeChatId);
                localStorage.setItem('nova_dark', state.darkMode);
                localStorage.setItem('nova_system', state.systemPrompt);
                localStorage.setItem('nova_temp', state.temperature);
                localStorage.setItem('nova_lang', state.language);
                localStorage.setItem('nova_theme', state.themeColor);
            }

            function applyTheme() {
                if (state.darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }

            function applyThemeColor() {
                const colors = {
                    'green': '#19c37d',
                    'blue': '#3b82f6',
                    'purple': '#a855f7',
                    'pink': '#ec4899',
                    'red': '#ef4444',
                    'orange': '#f59e0b',
                    'black': '#000000'
                };
                const color = colors[state.themeColor] || '#19c37d';
                document.documentElement.style.setProperty('--accent-color', color);
                
                // Update send button color
                document.querySelectorAll('.send-btn').forEach(btn => {
                    btn.style.backgroundColor = color;
                });
                document.querySelectorAll('.mode-badge').forEach(badge => {
                    badge.style.backgroundColor = color;
                });
            }

            function renderChatLists() {
                const desktopList = document.getElementById('chatListDesktop');
                const mobileList = document.getElementById('chatListMobile');
                const html = state.chats.map(chat => `
                    <div class="chat-item ${chat.id === state.activeChatId ? 'bg-[#e5e5e5] dark:bg-[#40414f]' : ''} p-2 rounded-md cursor-pointer hover:bg-[#e5e5e5] dark:hover:bg-[#40414f] flex justify-between items-center" onclick="loadChat('${chat.id}')">
                        <span class="truncate">${chat.title}</span>
                        <button onclick="event.stopPropagation();deleteChat('${chat.id}')" class="text-gray-500 hover:text-red-500">
                            <i class="fas fa-trash text-xs"></i>
                        </button>
                    </div>
                `).join('');
                if (desktopList) desktopList.innerHTML = html;
                if (mobileList) mobileList.innerHTML = html;
            }

            window.loadChat = function(id) {
                state.activeChatId = id;
                saveState();
                renderChatLists();
                loadActiveChat();
            };

            window.deleteChat = function(id) {
                state.chats = state.chats.filter(c => c.id !== id);
                if (state.activeChatId === id) {
                    state.activeChatId = state.chats[0]?.id || null;
                    if (!state.activeChatId) createNewChat();
                }
                saveState();
                renderChatLists();
                loadActiveChat();
            };

            function loadActiveChat() {
                const chat = state.chats.find(c => c.id === state.activeChatId);
                const welcome = document.getElementById('welcomeScreen');
                const feed = document.getElementById('messageFeed');
                
                if (!chat) return;

                if (chat.messages.length === 0) {
                    welcome.style.display = 'flex';
                    feed.classList.add('hidden');
                } else {
                    welcome.style.display = 'none';
                    feed.classList.remove('hidden');
                    feed.innerHTML = chat.messages.map(msg => `
                        <div class="message-row ${msg.role}">
                            <div class="bubble ${msg.role}">
                                ${msg.role === 'assistant' ? marked.parse(msg.content) : marked.parse(msg.content)}
                            </div>
                        </div>
                    `).join('');
                    
                    // Enhance code blocks
                    document.querySelectorAll('.bubble.assistant pre').forEach(pre => {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'code-block';
                        const header = document.createElement('div');
                        header.className = 'code-header';
                        header.innerHTML = '<span>Code</span><button class="copy-btn">Copy code</button>';
                        const content = document.createElement('div');
                        content.className = 'code-content';
                        content.innerHTML = pre.innerHTML;
                        wrapper.appendChild(header);
                        wrapper.appendChild(content);
                        pre.parentNode.replaceChild(wrapper, pre);
                    });

                    document.querySelectorAll('.copy-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const code = this.closest('.code-block').querySelector('.code-content').innerText;
                            navigator.clipboard.writeText(code);
                            this.innerText = 'Copied!';
                            setTimeout(() => this.innerText = 'Copy code', 1500);
                        });
                    });
                }
            }

            // Mode selection
            window.selectMode = function(mode) {
                currentMode = mode;
                
                document.querySelectorAll('.chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                
                const chipId = 'chip' + mode.charAt(0).toUpperCase() + mode.slice(1);
                document.getElementById(chipId).classList.add('active');
                
                const modeNames = {
                    'image': 'üé® Image Mode',
                    'code': 'üíª Code Mode',
                    'analyze': 'üìä Analysis Mode',
                    'brainstorm': 'üí° Brainstorm Mode'
                };
                
                document.getElementById('activeModeBadge').textContent = modeNames[mode];
                document.getElementById('modeIndicator').style.display = 'flex';
                
                document.getElementById('messageInput').focus();
            };

            // Cancel mode
            window.cancelMode = function() {
                currentMode = 'chat';
                document.querySelectorAll('.chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                document.getElementById('modeIndicator').style.display = 'none';
            };

            // Image upload
            document.getElementById('imageUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        selectedImage = e.target.result;
                        document.getElementById('imagePreview').src = selectedImage;
                        document.getElementById('imagePreviewContainer').style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });

            window.clearImage = function() {
                selectedImage = null;
                document.getElementById('imagePreviewContainer').style.display = 'none';
                document.getElementById('imageUpload').value = '';
            };

            // Send message
            async function sendMessage() {
                const input = document.getElementById('messageInput');
                const text = input.value.trim();
                
                let finalContent = text;
                
                // Add image if selected
                if (selectedImage) {
                    if (currentMode === 'image') {
                        finalContent = `Generate image based on: ${text}\n\nReference image: ${selectedImage}`;
                    } else {
                        finalContent = text + '\n\n[Image attached]';
                    }
                }
                
                if (!finalContent && !selectedImage) return;

                const chat = state.chats.find(c => c.id === state.activeChatId);
                if (!chat) return;

                let finalPrompt = finalContent;
                let modelToUse = DEFAULT_MODEL; // DeepSeek R1 free
                
                const langInstructions = {
                    'english': '',
                    'hindi': ' (‡§ï‡•É‡§™‡§Ø‡§æ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§Ç)',
                    'hinglish': ' (Hinglish mein jawab do)',
                    'urdu': ' (ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿßÿ±ÿØŸà ŸÖ€å⁄∫ ÿ¨Ÿàÿßÿ® ÿØ€å⁄∫)'
                };
                
                switch(currentMode) {
                    case 'image':
                        finalPrompt = `Generate an image: ${text}`;
                        modelToUse = 'openai/dall-e-3';
                        break;
                    case 'code':
                        finalPrompt = `Write code for: ${text}. Provide only the code with explanation.${langInstructions[state.language]}`;
                        modelToUse = DEFAULT_MODEL;
                        break;
                    case 'analyze':
                        finalPrompt = `Analyze this data/query: ${text}. Provide insights and patterns.${langInstructions[state.language]}`;
                        modelToUse = DEFAULT_MODEL;
                        break;
                    case 'brainstorm':
                        finalPrompt = `Brainstorm ideas about: ${text}. Give creative and diverse suggestions.${langInstructions[state.language]}`;
                        modelToUse = DEFAULT_MODEL;
                        break;
                    default:
                        finalPrompt = text + langInstructions[state.language];
                }

                chat.messages.push({ role: 'user', content: finalPrompt });
                input.value = '';
                clearImage();
                loadActiveChat();

                if (chat.title === 'New chat') {
                    chat.title = text.slice(0, 30) + (text.length > 30 ? '...' : '');
                    renderChatLists();
                }

                document.getElementById('typingIndicator').classList.remove('hidden');

                try {
                    if (abortController) abortController.abort();
                    abortController = new AbortController();

                    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${API_KEY}`,
                            'Content-Type': 'application/json',
                            'HTTP-Referer': window.location.origin
                        },
                        body: JSON.stringify({
                            model: modelToUse,
                            messages: [
                                { role: 'system', content: state.systemPrompt },
                                ...chat.messages.slice(-10)
                            ],
                            temperature: state.temperature,
                            stream: true
                        }),
                        signal: abortController.signal
                    });

                    if (!response.ok) throw new Error(`HTTP ${response.status}`);

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let assistantMessage = '';

                    document.getElementById('typingIndicator').classList.add('hidden');

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;

                        const chunk = decoder.decode(value);
                        const lines = chunk.split('\n').filter(l => l.startsWith('data:') && !l.includes('[DONE]'));

                        for (const line of lines) {
                            try {
                                const json = JSON.parse(line.replace('data:', ''));
                                const token = json.choices[0]?.delta?.content || '';
                                if (token) {
                                    assistantMessage += token;
                                    const last = chat.messages[chat.messages.length - 1];
                                    if (last?.role === 'assistant') {
                                        last.content = assistantMessage;
                                    } else {
                                        chat.messages.push({ role: 'assistant', content: assistantMessage });
                                    }
                                    loadActiveChat();
                                }
                            } catch (e) {}
                        }
                    }
                    saveState();
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        chat.messages.push({ role: 'assistant', content: `Error: ${error.message}` });
                        loadActiveChat();
                    }
                } finally {
                    document.getElementById('typingIndicator').classList.add('hidden');
                }
            }

            // Settings functions
            window.openSettings = function() {
                document.getElementById('settingsModal').classList.remove('hidden');
                document.getElementById('settingsModal').classList.add('flex');
            };
            window.closeSettings = function() {
                document.getElementById('settingsModal').classList.add('hidden');
                document.getElementById('settingsModal').classList.remove('flex');
            };
            window.saveSettings = function() {
                state.systemPrompt = document.getElementById('systemPromptInput').value;
                state.temperature = parseFloat(document.getElementById('temperatureRange').value);
                saveState();
                closeSettings();
            };

            // Language functions
            window.openLanguageSettings = function() {
                closeSettings();
                document.getElementById('languageModal').classList.remove('hidden');
                document.getElementById('languageModal').classList.add('flex');
            };
            window.selectLanguage = function(lang) {
                state.language = lang;
                saveState();
                updateLanguageDisplay();
                closeLanguageModal();
            };
            window.closeLanguageModal = function() {
                document.getElementById('languageModal').classList.add('hidden');
                document.getElementById('languageModal').classList.remove('flex');
            };
            function updateLanguageDisplay() {
                const langNames = {
                    'english': 'English',
                    'hindi': '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä',
                    'hinglish': 'Hinglish',
                    'urdu': 'ÿßÿ±ÿØŸà'
                };
                document.getElementById('selectedLanguageDisplay').textContent = langNames[state.language];
            }

            // About AI
            window.showAboutAI = function() {
                closeSettings();
                document.getElementById('aboutModal').classList.remove('hidden');
                document.getElementById('aboutModal').classList.add('flex');
            };
            window.closeAboutModal = function() {
                document.getElementById('aboutModal').classList.add('hidden');
                document.getElementById('aboutModal').classList.remove('flex');
            };

            // Data Control
            window.showDataControl = function() {
                closeSettings();
                const storageSize = new Blob([localStorage.getItem('nova_chats')]).size;
                document.getElementById('storageSize').textContent = (storageSize / 1024).toFixed(2) + ' KB';
                document.getElementById('dataControlModal').classList.remove('hidden');
                document.getElementById('dataControlModal').classList.add('flex');
            };
            window.closeDataControlModal = function() {
                document.getElementById('dataControlModal').classList.add('hidden');
                document.getElementById('dataControlModal').classList.remove('flex');
            };
            window.exportData = function() {
                const data = JSON.stringify(state.chats, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'novamind-chats.json';
                a.click();
            };

            // Clear History
            window.confirmClearHistory = function() {
                if (confirm('Are you sure you want to delete all chats?')) {
                    state.chats = [];
                    createNewChat();
                    saveState();
                    renderChatLists();
                    loadActiveChat();
                    closeSettings();
                }
            };

            // Theme Color
            window.openThemeSettings = function() {
                closeSettings();
                document.getElementById('themeModal').classList.remove('hidden');
                document.getElementById('themeModal').classList.add('flex');
            };
            window.selectTheme = function(theme) {
                state.themeColor = theme;
                saveState();
                applyThemeColor();
                const themeNames = {
                    'green': 'Green',
                    'blue': 'Blue',
                    'purple': 'Purple',
                    'pink': 'Pink',
                    'red': 'Red',
                    'orange': 'Orange',
                    'black': 'Black'
                };
                document.getElementById('selectedThemeDisplay').textContent = themeNames[theme];
                closeThemeModal();
            };
            window.closeThemeModal = function() {
                document.getElementById('themeModal').classList.add('hidden');
                document.getElementById('themeModal').classList.remove('flex');
            };

            function setupEventListeners() {
                document.getElementById('newChatDesktop').addEventListener('click', createNewChat);
                document.getElementById('newChatMobile').addEventListener('click', createNewChat);
                document.getElementById('settingsDesktop').addEventListener('click', openSettings);
                document.getElementById('settingsMobile').addEventListener('click', openSettings);
                
                document.getElementById('darkModeDesktop').addEventListener('click', () => {
                    state.darkMode = !state.darkMode;
                    applyTheme();
                    saveState();
                });
                document.getElementById('darkModeMobile').addEventListener('click', () => {
                    state.darkMode = !state.darkMode;
                    applyTheme();
                    saveState();
                });

                document.getElementById('sendBtn').addEventListener('click', sendMessage);
                document.getElementById('messageInput').addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });

                document.getElementById('temperatureRange').addEventListener('input', (e) => {
                    document.getElementById('tempDisplay').innerText = e.target.value;
                });

                // Mobile sidebar
                document.getElementById('openMobileSidebar').addEventListener('click', () => {
                    document.getElementById('mobileSidebar').classList.remove('-translate-x-full');
                });
                document.getElementById('closeMobileSidebar').addEventListener('click', () => {
                    document.getElementById('mobileSidebar').classList.add('-translate-x-full');
                });
            }

            init();
        })();
    </script>
</body>
                  </html>
